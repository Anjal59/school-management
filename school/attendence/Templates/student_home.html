{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <style>
        *{
            margin:0;
            padding:0;
            box-sizing:border-box;
        }

        body{
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background:#f0f2f5;
        }

        /* Navbar */
        .navbar{
            height:80px;
            background:#102a46;
            color:white;
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:0 20px;
            box-shadow:0 2px 6px rgba(0,0,0,0.2);
        }

        .navbar h2{
            font-size:20px;
        }

        .navbar button{
            background:#dc3545;
            border:none;
            padding:8px 15px;
            border-radius:5px;
            color:white;
            cursor:pointer;
        }

        .navbar button:hover{
            background:#c82333;
        }

        /* Layout */
        .main{
            display:flex;
            min-height:calc(100vh - 60px);
        }

        /* Sidebar */
        .sidebar{
            width:250px;
            background:white;
            padding:20px;
            border-right:1px solid #ddd;
            text-align:center;
        }

        .sidebar img{
            width:100px;
            height:100px;
            border-radius:50%;
            object-fit:cover;
            margin-bottom:15px;
        }

        .sidebar h3{
            margin-bottom:20px;
        }

        .sidebar a{
            display:block;
            text-decoration:none;
            padding:10px;
            margin-bottom:10px;
            border-radius:5px;
            background:#f5f5f5;
            color:#333;
            transition:0.3s;
        }

        .sidebar a:hover{
            background:#162b42;
            color:white;
        }

        /* Content */
        .content{
            flex:1;
            padding:20px;
        }

        .card{
            background:white;
            padding:20px;
            margin-bottom:20px;
            border-radius:10px;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
        }

        .card h2{
            margin-bottom:15px;
            border-bottom:2px solid #eee;
            padding-bottom:5px;
        }

        .item-box{
            background:#f9f9f9;
            padding:10px;
            border-radius:5px;
            margin-bottom:15px;
        }

        textarea, button{
            width:100%;
            padding:8px;
            border-radius:5px;
            border:1px solid #ccc;
            margin-top:8px;
        }

        button{
            background:#28a745;
            color:white;
            border:none;
            cursor:pointer;
            font-weight:bold;
        }

        button:hover{
            background:#218838;
        }

        .grid{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:20px;
        }

        .message-success{
            color:green;
            font-weight:bold;
        }

        @media(max-width:768px){
            .main{
                flex-direction:column;
            }

            .sidebar{
                width:100%;
            }

            .grid{
                grid-template-columns:1fr;
            }
        }
    </style>
</head>

<body>

<!-- Navbar -->
<div class="navbar">
    <h2>Student Portal</h2>
    <form action="{% url 'logout' %}" method="POST">
        {% csrf_token %}
        <button type="submit">Logout</button>
    </form>
</div>

<div class="main">

    <!-- Sidebar -->
    <div class="sidebar">
        <img src="https://static.vecteezy.com/system/resources/previews/045/358/292/non_2x/a-cartoon-boy-in-a-school-uniform-vector.jpg" alt="Student Photo">
        <h3>{{ user.username }}</h3>

        <a href="#attendance">Mark Attendance</a>
        <a href="#history">Attendance History</a>
        <a href="#notifications">Notifications</a>
        <a href="#tasks">Tasks</a>
    </div>

    <!-- Content -->
    <div class="content">

        <!-- Mark Attendance -->
        <div class="card" id="attendance">
            <h2>Mark Today's Attendance</h2>

            {% if already_marked %}
                <p class="message-success">
                    You have already marked attendance today ✅
                </p>
            {% else %}
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="attendance_submit" value="1">
                    <button type="submit">Mark Attendance</button>
                </form>
            {% endif %}
        </div>

        <div class="grid">

            <!-- Attendance History -->
            <div class="card" id="history">
                <h2>Attendance History</h2>
                {% for a in attendance %}
                    <div class="item-box">
                        {{ a.date }} - {{ a.status }}
                    </div>
                {% empty %}
                    <p>No attendance records</p>
                {% endfor %}
            </div>

            <!-- Notifications -->
            <div class="card" id="notifications">
                <h2>Teacher Notifications</h2>
                {% for n in notifications %}
                    <div class="item-box">
                        {{ n.message }} <br>
                        <small>{{ n.created_at }}</small>
                    </div>
                {% empty %}
                    <p>No notifications</p>
                {% endfor %}
            </div>

        </div>

        <!-- Tasks -->
        <div class="card" id="tasks">
            <h2>Assigned Tasks</h2>

            {% for task in tasks %}
                <div class="item-box">
                    <strong>{{ task.title }}</strong>
                    <p>{{ task.description }}</p>
                    <small>Due: {{ task.due_date }}</small>
                    <br><br>

                    {% with submitted=False %}
                        {% for sub in submissions %}
                            {% if sub.task.id == task.id %}
                                <p class="message-success">
                                    ✅ Already Submitted
                                </p>
                                {% with submitted=True %}{% endwith %}
                            {% endif %}
                        {% endfor %}

                        {% if not submitted %}
                            <form method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="task_submit" value="1">
                                <input type="hidden" name="task_id" value="{{ task.id }}">

                                <textarea name="submission_text"
                                          rows="3"
                                          placeholder="Write your answer here"></textarea>
                                <button type="submit">Submit Task</button>
                            </form>
                        {% endif %}
                    {% endwith %}
                </div>
            {% empty %}
                <p>No tasks assigned</p>
            {% endfor %}
        </div>

    </div>

</div>

</body>
</html>